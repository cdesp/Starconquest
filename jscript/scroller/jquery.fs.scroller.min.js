/*
 * Scroller Plugin [Formstone Library]
 * @author Ben Plum
 * @version 0.6.3
 *
 * Copyright Â© 2013 Ben Plum <mr@benplum.com>
 * Released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 */
 
if(jQuery)(function(d){function l(b){b=d.extend({},g,b||{});for(var a=d(this),c=0,e=a.length;c<e;c++)m(a.eq(c),b);return a}function m(b,a){if(!b.data("scroller")){d.extend(a,b.data("scroller-options"));var c;c='<div class="scroller-bar"><div class="scroller-track"><div class="scroller-handle">';c+="</div></div></div>";a.paddingRight=parseInt(b.css("padding-right"),10);a.paddingBottom=parseInt(b.css("padding-bottom"),10);b.addClass(a.customClass+" scroller").wrapInner('<div class="scroller-content" />').prepend(c); a.horizontal&&b.addClass("scroller-horizontal");a=d.extend({$scroller:b,$content:b.find(".scroller-content"),$bar:b.find(".scroller-bar"),$track:b.find(".scroller-track"),$handle:b.find(".scroller-handle")},a);a.$content.on("scroll.scroller",a,h);a.$scroller.on("mousedown.scroller",".scroller-track",a,n).on("mousedown.scroller",".scroller-handle",a,p).data("scroller",a);e.reset.apply(b,[a]);d(window).one("load",function(){e.reset.apply(b,[a])})}}function h(b){b.preventDefault();b.stopPropagation(); b=b.data;if(!0==b.horizontal){var a=b.$content.scrollLeft();0>a&&(a=0);a/=b.scrollRatio;a>b.handleBounds.right&&(a=b.handleBounds.right);b.$handle.css({left:a})}else a=b.$content.scrollTop(),0>a&&(a=0),a/=b.scrollRatio,a>b.handleBounds.bottom&&(a=b.handleBounds.bottom),b.$handle.css({top:a})}function n(b){b.preventDefault();b.stopPropagation();var a=b.data,c=a.$track.offset();!0==a.horizontal?(a.mouseStart=b.pageX,a.handleLeft=b.pageX-c.left-a.handleWidth/2,f.apply(a.$scroller,[a,a.handleLeft])): (a.mouseStart=b.pageY,a.handleTop=b.pageY-c.top-a.handleHeight/2,f.apply(a.$scroller,[a,a.handleTop]));a.$scroller.data("scroller",a);a.$content.off(".scroller");d("body").on("mousemove.scroller",a,j).on("mouseup.scroller",a,k)}function p(b){b.preventDefault();b.stopPropagation();var a=b.data;!0==a.horizontal?(a.mouseStart=b.pageX,a.handleLeft=parseInt(a.$handle.css("left"),10)):(a.mouseStart=b.pageY,a.handleTop=parseInt(a.$handle.css("top"),10));a.$scroller.data("scroller",a);a.$content.off(".scroller"); d("body").on("mousemove.scroller",a,j).on("mouseup.scroller",a,k)}function j(b){b.preventDefault();b.stopPropagation();var a=b.data,c=0;!0==a.horizontal?(b=a.mouseStart-b.pageX,c=a.handleLeft-b):(b=a.mouseStart-b.pageY,c=a.handleTop-b);f.apply(a.$scroller,[a,c])}function k(b){b.preventDefault();b.stopPropagation();b=b.data;b.$content.on("scroll.scroller",b,h);d("body").off(".scroller")}function f(b,a){if(!0==b.horizontal){a<b.handleBounds.left&&(a=b.handleBounds.left);a>b.handleBounds.right&&(a=b.handleBounds.right); var c=Math.round(a*b.scrollRatio);b.$handle.css({left:a});b.$content.scrollLeft(c)}else a<b.handleBounds.top&&(a=b.handleBounds.top),a>b.handleBounds.bottom&&(a=b.handleBounds.bottom),c=Math.round(a*b.scrollRatio),b.$handle.css({top:a}),b.$content.scrollTop(c)}var g={customClass:"",trackMargin:0,handleSize:!1,horizontal:!1},e={defaults:function(b){g=d.extend(g,b||{});return d(this)},destroy:function(){return d(this).each(function(){var b=d(this).data("scroller");b&&(b.$scroller.removeClass(b.customClass).removeClass("scroller").removeClass("scroller-active"), b.$content.replaceWith(b.$content.html()),b.$bar.remove(),b.$content.off(".scroller"),b.$scroller.off(".scroller").removeData("scroller"))})},scroll:function(b){var a=d(this).data("scroller");"number"!=typeof b&&(b=d(b),0<b.length?(b=b.position(),b=!0==a.horizontal?b.left+a.$content.scrollLeft():b.top+a.$content.scrollTop()):b=a.$content.scrollTop());!0==a.horizontal?a.$content.animate({scrollLeft:b}):a.$content.animate({scrollTop:b});return d(this)},reset:function(b){return d(this).each(function(){var a= b||d(this).data("scroller");if("undefined"!=typeof a){a.$scroller.addClass("scroller-setup");if(!0==a.horizontal)a.barHeight=a.$content[0].offsetHeight-a.$content[0].clientHeight,a.frameWidth=a.$content.outerWidth(),a.trackWidth=a.frameWidth-2*a.trackMargin,a.scrollWidth=a.$content[0].scrollWidth,a.ratio=a.trackWidth/a.scrollWidth,a.trackRatio=a.trackWidth/a.scrollWidth,a.handleWidth=a.handleSize?a.handleSize:a.trackWidth*a.trackRatio,a.scrollRatio=(a.scrollWidth-a.frameWidth)/(a.trackWidth-a.handleWidth), a.handleBounds={left:0,right:a.trackWidth-a.handleWidth},a.$scroller.data("scroller",a),a.$content.css({paddingBottom:a.barHeight+a.paddingBottom}),a.$content.scrollLeft(),a.scrollWidth<=a.frameWidth?a.$scroller.removeClass("scroller-active"):a.$scroller.addClass("scroller-active"),a.$bar.css({width:a.frameWidth}),a.$track.css({width:a.trackWidth,marginLeft:a.trackMargin,marginRight:a.trackMargin}),a.$handle.css({width:a.handleWidth});else{a.barWidth=a.$content[0].offsetWidth-a.$content[0].clientWidth; a.frameHeight=a.$content.outerHeight();a.trackHeight=a.frameHeight-2*a.trackMargin;a.scrollHeight=a.$content[0].scrollHeight;a.ratio=a.trackHeight/a.scrollHeight;a.trackRatio=a.trackHeight/a.scrollHeight;a.handleHeight=a.handleSize?a.handleSize:a.trackHeight*a.trackRatio;a.scrollRatio=(a.scrollHeight-a.frameHeight)/(a.trackHeight-a.handleHeight);a.handleBounds={top:0,bottom:a.trackHeight-a.handleHeight};a.$scroller.data("scroller",a);var c=a.$content.scrollTop()*a.ratio;a.scrollHeight<=a.frameHeight? a.$scroller.removeClass("scroller-active"):a.$scroller.addClass("scroller-active");a.$bar.css({height:a.frameHeight});a.$track.css({height:a.trackHeight,marginBottom:a.trackMargin,marginTop:a.trackMargin});a.$handle.css({height:a.handleHeight})}f.apply(a.$scroller,[a,c]);a.$scroller.removeClass("scroller-setup")}})}};d.fn.scroller=function(b){return e[b]?e[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"===typeof b||!b?l.apply(this,arguments):this}})(jQuery);